# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Vaadin 24.9.4 application built with Spring Boot 3.5.7 and Java 25. The project integrates Embabel Agent (
v0.1.4), an AI agent framework that supports both OpenAI and Ollama providers. The application uses a hybrid
architecture with Java-based server-side views and React/TypeScript for client-side components.

## Key Dependencies

- **Embabel Agent**: AI agent framework with starters for OpenAI and Ollama
    - `embabel-agent-starter`: Core agent functionality
    - `embabel-agent-starter-openai`: OpenAI integration
    - `embabel-agent-starter-ollama`: Ollama integration
- **Vaadin**: Full-stack framework combining Java backend with web components
- **React**: Frontend library (v18.3.1) for client-side views
- **Spring Boot**: Application framework with dependency injection

## Build & Run Commands

### Development

```bash
# Run application in development mode (default goal)
./mvnw spring-boot:run

# Or simply
./mvnw
```

**Important**: Use the IntelliJ "Debug using HotswapAgent" option if you have the Vaadin plugin installed to see Java
changes reflected immediately in the browser.

### Production Build

```bash
# Create production JAR with optimized frontend bundle
./mvnw clean package -Pproduction

# Run production JAR
java -jar target/practical-embabel-1.0-SNAPSHOT.jar
```

### Code Formatting

```bash
# Check formatting (Java uses Eclipse formatter, TypeScript uses Prettier)
./mvnw spotless:check

# Apply formatting
./mvnw spotless:apply
```

### Testing

```bash
# Run unit tests
./mvnw test

# Run integration tests (starts app, runs tests, stops app)
./mvnw verify -Pit
```

## Architecture

### Hybrid View System

The application uses both Java-based and React-based views:

- **Java Views**: Located in `src/main/java/dev/nathanlively/views/`, use Vaadin Flow components
    - Example: `BasicCall.java` - AI chat interface using Vaadin MessageList and MessageInput
- **React Views**: Would be located in `src/main/frontend/views/` (currently empty)
- Both view types integrate seamlessly through Vaadin's routing system

### Navigation & Layout

- `MainLayout.java` (src/main/java/dev/nathanlively/views/MainLayout.java:27) provides the application shell with side
  navigation
- Uses `AppLayout` with drawer navigation built from `@Menu` annotations on view classes
- View titles automatically update based on current route
- Theme configured as dark mode Lumo variant in Application.java:15

### AI Integration Pattern

The Embabel Agent framework uses dependency injection:

1. Inject `AiBuilder` into view constructors
2. Create `Ai` instances using `builder.ai()`
3. Call `ai.withAutoLlm().generateText(prompt)` for text generation
4. The framework automatically selects available LLM provider (OpenAI/Ollama)

See BasicCall.java:41-43 for reference implementation.

### Frontend Structure

- **Generated files**: `src/main/frontend/generated/` - Auto-generated by Vaadin, do not edit
- **Theme**: `src/main/frontend/themes/practical-embabel/` - CSS customizations
- **TypeScript config**: Base URL is `src/main/frontend` with path aliases for Vaadin resources
- **Build tool**: Vite (configured by Vaadin Maven plugin)

## Configuration

### Environment Variables

Required in `.env` (gitignored, contains sensitive API keys):

- `OPENAI_API_KEY`: OpenAI API key for AI functionality
- `GEMINI_API_KEY`: Google Gemini API key (if using Gemini)

### Embabel Agent Configuration

The `@EnableAgents` annotation on Application.java:12 enables AI agent functionality with Star Wars themed logging.

### Code Style

- **Java**: Eclipse formatter profile "Vaadin Java Conventions 20241010" (eclipse-formatter.xml)
- **TypeScript**: Prettier with single quotes, 120 char width, bracket same line (.prettierrc.json)
- Always run `./mvnw spotless:apply` before committing

## Maven Profiles

- `production`: Optimizes frontend bundle and excludes dev dependencies
- `it`: Runs integration tests with automatic server lifecycle management

## Important Notes

- The `src/main/frontend/generated/` directory is auto-generated by Vaadin - never edit these files
- Frontend changes require the Vaadin dev server to be running (automatic with `spring-boot:run`)
- Java 25 is required (specified in pom.xml:14)
- The application uses Spring Boot DevTools for automatic restart during development
